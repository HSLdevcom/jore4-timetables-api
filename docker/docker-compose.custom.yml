---
version: "3.8"
services:
  # build and run the local image instead
  # note: it's currently expose on port 3009
  jore4-timetables-api:
    build:
      context: ".."
    environment:
      - JORE4_DB_HOSTNAME=jore4-testdb
      - JORE4_DB_DATABASE=${POSTGRES_DB}
      - JORE4_DB_USERNAME=${POSTGRES_USER}
      - JORE4_DB_PASSWORD=${POSTGRES_PASSWORD}

  jore4-hasura:
    # locking hasura image so that we can develop against a static graphql API
    # Link to available jore4-hasura images in Docker Hub:
    # https://hub.docker.com/r/hsldevcom/jore4-hasura/tags?page=1&ordering=last_updated
    image: "hsldevcom/jore4-hasura:hsl-main--20231018-9ac77e26ea52ef806988faf1455bb53e74bbec3f"
    # Waiting for database to be ready to avoid startup delay due to hasura crashing at startup if db is offline
    # Note: this should only be done in development setups as Kubernetes does not allow waiting for services to be ready
    depends_on:
      jore4-testdb:
        condition: service_healthy
